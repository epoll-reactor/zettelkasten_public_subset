Термин "TCP/IP" используется везде где идёт речь о специфичных протоколах для
TCP или IP. Этот термин может включать в себя различные другие протоколы (UDP,
ARP, ICMP).

Нужно понять следующую схему:

     ----------------------------
     |    network applications  |
     |                          |
     |...  \ | /  ..  \ | /  ...|
     |     -----      -----     |
     |     |TCP|      |UDP|     |
     |     -----      -----     |
     |         \      /         |
     |         --------         |
     |         |  IP  |         |
     |  -----  -*------         |
     |  |ARP|   |               |
     |  -----   |               |
     |      \   |               |
     |      ------              |
     |      |ENET|              |
     |      ---@--              |
     ----------|-----------------
               |
 --------------o---------
             Ethernet Cable

"o" - приёмник связи
"*" - IP адрес
"@" - Ethernet адрес

Имя единицы данных перемещающейся по интернету зависит от её расположения
в сетевом стеке.
  Ethernet-кабель:                         Ethernet-фрейм
  Между Ethernet-драйвером и IP модулем:   IP-пакет
  Между IP и UDP модулем:                  UDP-датаграмма
  Между IP и TCP модулем:                  TCP-сегмент (transport message)
  Сетевое приложение:                      сообщение приложения

Ethernet-драйвер - ПО, общающееся с сетевым "железом" напрямую.

FTP - типичный протокол использующий TCP. Пример цепи: FTP/TCP/IP/ENET
SNMP (Simple Network Management Protocol)
    - типичный протокол использующий UDP. Пример цепи: SNMP/UDP/IP/ENET

TCP и UDP модули - N-to-1 мультиплексеры.

     1   2 3 ...   n                   1   2 3 ...   n
      \  | |      /    |                \  | |      /      ^
       \ | |     /     |                 \ | |     /       |
     -------------   flow             ----------------   flow
     |multiplexer|    of              |de-multiplexer|    of
     -------------   data             ----------------   data
          |            |                    |              |
          |            v                    |              |
          1                                 1

Компьютер имеет 4-байтовый IP адрес, расположенный на нижнем уровне интерфейса
к IP-модулю. Компьютер подключенный к сети всегда знает свой IP-адрес и 
Ethernet-адрес.

      ----------------------------
      |    network applications  |
      |                          |
      |...  \ | /  ..  \ | /  ...|
      |     -----      -----     |
      |     |TCP|      |UDP|     |
      |     -----      -----     |
      |         \      /         |
      |         --------         |
      |         |  IP  |         |
      |  -----  -*----*-  -----  |
      |  |ARP|   |    |   |ARP|  |
      |  -----   |    |   -----  |
      |      \   |    |   /      |
      |      ------  ------      |
      |      |ENET|  |ENET|      |
      |      ---@--  ---@--      |
      ----------|-------|---------
                |       |
                |    ---o---------------------------
                |             Ethernet Cable 2
 ---------------o----------
             Ethernet Cable 1

Такой компьютер имеет 2 Ethernet-адреса и 2 IP-адреса. В таком случае
IP-модуль - N-to-M мультиплексер и M-to-N демультиплексер. Данные могут быть
переданы с любого на любой сетевой модуль.

Процесс передачи IP-пакета в другую сеть называется передачей IP-пакета.
Компьютер, призванный решать эту задачу называется IP-маршрутизатор (router).

            TCP      UDP
              \      /
               \    /
           --------------
           |     IP     |
           |            |
           |    ---     |
           |   /   \    |
           |  /     v   |
           --------------
             /        \
            /          \
          data         data
         comes in       goes out
        here             here

Мы видим, что данные не должны проходить дальше IP-модуля. По этой причине
некоторые IP-роутеры не имеют TCP и UDP модулей.

Каждый модуль или драйвер добавляет свой заголовок к сообщению, передаваемому
вниз по сетевому стеку. И наоборот, каждый модуль убирает заголовок
сообщения при передаче вверх по сетевому стеку на пути к приложению. К
приложению приходят заголовки только самого верхнего уровня.

IP-заголовок содержит IP-адрес.

Набор взаимоподключённых физических сетей, объединённый в логическую сеть,
называется интернетом.

Ethernet-фрейм состоит из адреса получателя, адреса отправителя, поля типа и
данных. Ethernet-адрес имеет длину 6 байт, он уникальный для каждого
устройства. Также все устройства "слушают" предмет наличия Ethernet-фреймов,
с адресом в формате "FF-FF-FF-FF-FF-FF", такой адрес называется
широковещательным.

Ethernet использует CSMA/CD (Carrier Sense and Multiple Access with
Collision Detection) для обмена данными внутри одного устройства.

Хорошая аналогия CSMA/CD - группа людей, находящихся в одной маленькой,
полностью тёмной комнате. Здесь источники радиоволн заменяются голосами.
Каждый человек может слышать речь любого другого человека (Carrier sense).
Каждый человек имеет равные возможности говорить (Multiple Access).
Никто не позволяет себе долгих речей, потому что люди вежливые и ценят время
остальных. Если кто-то недостаточно вежлив, его просят покинуть комнату
(выброс из сети). Никто не позволяет себе перебивать других. Когда один
человек начинает говорить, все остальные ждут пока он окончит свою речь. Если
вдруг 2 человека начало говорить одновременно, один из них начинает ждать,
пока договорит другой (Collision Detection). Каждый человек имеет своё имя
в целях избежания коллизии имён. Каждый раз, когда кто-то говорит, он
озвучивает, к кому обращается: "Привет Александр, это Майкл, ...". Если
кто-то хочет обратиться ко всем, он говорит: "Привет всем, это Майкл, ..."
(broadcast).

ARP (Address Resolution Protocol) используется для преобразования IP-адресов
в Ethernet-адреса. Преобразование происходит с помощью просмотра таблицы.
ARP-таблица хранится в памяти и содержит строку для каждого компьютера.
Колонка для IP-адреса и колонка для Ethernet-адреса.

 ------------------------------------
 |IP address       Ethernet address |
 ------------------------------------
 |223.1.2.1        08-00-39-00-2F-C3|
 |223.1.2.3        08-00-5A-21-A7-22|
 |223.1.2.4        08-00-10-99-AC-54|
 ------------------------------------
   TABLE 1.  Example ARP Table

ARP-таблица важна потому что IP и Ethernet-адреса выбираются независимо.
Алгоритм преобразования IP-адресов в Ethernet-адреса использовать невозможно.
Если с помощью ARP-таблицы нельзя преобразовать адрес:
  1) Запрашиваемый пакет по широковещательному каналу отправляется на каждый
     компьютер.
  2) Исходящий IP-пакет ставится в очередь.

IP-модуль это центральная часть интернета и route table его главная часть.
IP принимает все решения о маршрутизации опираясь на эту таблицу. Содержимое
этой таблицы определяется сетевым администратором.

Допустим есть два компьютера А и Б. Когда А хочет отправить Б сообщение, он
составляет IP-заголовок, в котором находится IP-адрес А как адрес
отправителя, Ethernet-хедер, содержащий Ethernet-адрес компьютера А.
Также, IP-заголовок содержит IP-адрес Б как адрес доставки и Ethernet-заголо-
вок, содержащий Ethernet-адрес Б как адрес доставки.

Допустим есть два компьютера А и Б. Когда А хочет отправить Б сообщение, он
составляет IP-заголовок с адресом отправителя и получателя, а так же 
Ethernet-заголовок с адресом отправителя и получателя. Таким образом:

 ------------------------------------------
 |адрес            отправитель  получатель|
 ------------------------------------------
 |IP-заголовок           A           Б    |
 |Ethernet-заголовок     A           Б    |
 ------------------------------------------

Наш Ethernet-фрейм будет выглядеть так.

    A      B      C      ----D----      E      F      G
    |      |      |      |   |   |      |      |      |
  --o------o------o------o-  |  -o------o------o------o--
  Ethernet 1                 |  Ethernet 2
  IP network "development"   |  IP network "accounting"
                             |
                             |
                             |     H      I      J
                             |     |      |      |
                           --o-----o------o------o--
                            Ethernet 3
                            IP network "factory"

Кроме компьютера D, все имеют полный TCP/IP стек. D - IP-роутер. Он подключен
к каждой из трёх сетей и следовательно имеет 3 IP и Ethernet-адреса. D имеет
такой же TCP/IP стек, за исключением того, что он имеет 3 ARP и Ethernet
модулей вместо 2. D имеет только один IP-модуль.

При передаче пакета от A к B процесс передачи пакета идентичен описанному
выше.

A - B - прямое соединение,
A - D - прямое соединение,
A - F - непрямое соединение.

При передаче пакета от A к E -

 ----------------------------------------
 |address            source  destination|
 ----------------------------------------
 |IP header          A       E          |
 |Ethernet header    A       D          |
 ----------------------------------------

IP-адрес доставки - E - потому что это конечная цель доставки
Ethernet-адрес доставки - D - потому что D это роутер и должен передать пакет

Когда D получает такой пакет, он "говорит": "Здесь указан не мой IP-адрес,
поэтому я передаю пакет напрямую к E". При этом пакет изменяется:

 ----------------------------------------
 |address            source  destination|
 ----------------------------------------
 |IP header          A       E          |
 |Ethernet header    D       E          |
 ----------------------------------------

UDP - один из двух главных протоколов, находящийся поверх IP. Пример исполь-
зования UDP: Network File System (NFS).
UDP - служба доставки данных без подключения, НЕ гарантирующий доставку в
целости и сохранности. UDP не поддерживает end-to-end соединения. Он просто
передаёт очередную датаграмму в сеть или принимает такие же датаграммы из
сети. Соединение естественно осуществляется с помощью портов.

TCP - протокол поверх IP, устанавливающий соединение. TCP гарантирует
корректную доставку, UDP - нет. Пример использования TCP - File Transfer
Protocol (FTP) и TELNET. X-Window System также использует TCP.
